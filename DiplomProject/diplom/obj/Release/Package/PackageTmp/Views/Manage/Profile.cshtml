@model diplom.Models.ChangeLoginOrPhoneViewModel
<div class="profile-header">
    <div class="profile-header-inner container">
        <div class="box box_bonuses">
            <div class="image">
                <i class="icon"></i>
            </div>
            <div class="title">
                Бонусы:
                <span class="count">@ViewBag.User.Points.Points</span>
            </div>
        </div>
        <div class="profile-user">
            <div class="profile-avatar">
                <img class="i-avatar" src="~/Content/img/avatar/g.png" width="90" height="90" alt="">
            </div>
            <div class="profile-user-row">
                <div class="profile-user-email">
                    @ViewBag.User.Email
                </div>
                @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @style = "all:unset" }))
                {
                    <a class="profile-user-logout" href="javascript:document.getElementById('logoutForm').submit()">Выйти</a>
                }
            </div>
        </div>
    </div>
</div>
<hr style="    color: #ddd;">

<div class="profile-menu">
    <div class="profile-menu-inner container">
        <ul class="tabs" id="profileTabs">
            <li class="tabsi active">
                <a class="tabsi__title" href="#profileEdit" data-toggle="tab" aria-expanded="true">
                    Профиль
                </a>
            </li>
            <li class="tabsi">
                <a class="tabsi__title" href="#profileHistory" data-toggle="tab" aria-expanded="false">
                    История операций
                </a>
            </li>
        </ul>
    </div>
</div>
<div class="profile-content">
    <div class="profile-content-inner container">
        <div class="tab-content" id="userPanel">
            <hr style="    color: #ddd;">
            <div class="tab-pane fade active in" id="profileEdit">
                <div class="profile-edit" id="changeProfile">
                    <h3 style="color:red">
                        @ViewBag.MessageError
                    </h3>
                    <h3 style="color:#ff6600">
                        @ViewBag.Message
                    </h3>
                    @using (Ajax.BeginForm("ChangeProfile", "Manage", null, new AjaxOptions
                    {
                        HttpMethod = "POST",
                        UpdateTargetId = "changeProfile"
                    }, new { @class = "form", @style = "all:unset" }))
                    {


                        @Html.ValidationSummary(true, "", new { @style = "color:red;" })
                        <div class="formi formi_left">
                            <div class="form-group">
                                <label for="profileUsername">
                                    Логин
                                </label>
                                @Html.TextBoxFor(m => m.Name, new { @class = "form-control", @Value = ViewBag.User.UserName })
                                @Html.ValidationMessageFor(m => m.Name, "", new { @style = "color:red;" })
                            </div>
                            <div class="form-group">
                                <label for="profileEmail">
                                    Номер телефона
                                </label>
                                @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control", @Value = ViewBag.User.PhoneNumber, @id = "phone" })
                                @Html.ValidationMessageFor(m => m.PhoneNumber, "", new { @style = "color:red;" })
                            </div>
                        </div>
                        <div class="formi formi_right">
                            <div class="profile-edit-links">
                                <div class="profile-edit-link __typeChangePassword">
                                    @*<a data-toggle="modal" data-target="#modalChangePassword" tabindex="7">
                                            <i class="icon"></i>
                                            Изменить пароль аккаунта
                                        </a>*@
                                    @Html.ActionLink("Изменить пароль аккаунта", "ChangePassword", "Manage", null, new { @id = "modalChangePassword" })
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <button class="btn btn_color btn_big" id="submitProfileBtn" type="submit" tabindex="8" style="background-color:#ff6600">
                                Сохранить изменения
                            </button>
                        </div>
                    }
                </div>


            </div>
            <div class="tab-pane fade" id="profileHistory">
                @*<h3>History</h3>*@
                @*<table class="table sortable">*@
                <table class="table table-bordered table-striped sortable">
                    <thead>
                        <tr><th data-defaultsort="disabled">Получено</th><th data-defaultsort="disabled">Потрачено</th><th data-defaultsign="month" class="up sorted" data-sortcolumn="3" data-sortkey="3-0">Дата сделки<span class="sign month up"></span></th></tr>
                    </thead>
                    <tbody>
                        @foreach (var operation in ViewBag.HistoryOperations)
                        {
                            <tr>
                                <td>@operation.Earned</td>
                                <td>@operation.Spent</td>
                                <td>@operation.Date</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            @*<div class="tab-pane fade" id="profileHistoryBon">
                <h3>History Bonus</h3>
            </div>*@
        </div>
    </div>
    <div id="modDialog1" class="modal fade">
        <div id="dialogContent1" class="modal-dialog"></div>
    </div>
</div>


@section scripts{
    <script src="~/Scripts/jquery.maskedinput.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function ($) {
            $("#phone").mask("+375(99) 999-99-99");
        });

        $(function () {
            $.ajaxSetup({ cache: false });
            $("#modalChangePassword").on("click", function (e) {
                $(e.target).closest('.btn-group').children('.dropdown-toggle').dropdown('toggle');
                $('#dialogContent1').load(this.href, function () {
                    $('#modDialog1').modal({
                        keyboard: true
                    }, 'show');
                    bindFormChangePsw(this);
                });
                return false;
            });
        });
        function bindFormChangePsw(dialog) {
            $('form', dialog).submit(function () {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        if (result.success) {
                            $('#modDialog1').modal('hide');
                            location.reload();
                        } else {
                            $('#dialogContent1').html(result);
                            bindForm();
                        }
                    }
                });
                return false;
            });
        }
    </script>
}